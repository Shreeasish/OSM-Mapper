<!doctype <!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
	<script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<title>Waypoint Mapper</title>
	<script type="text/javascript">
	onload = function(){

		// Initialize Map Tile
		window.map = L.map('map').setView([49.267576, -122.948819], 11);
		L.tileLayer('http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png', {}).addTo(map);
		window.routeLayer = L.geoJson().addTo(map);
		window.routeArray = [];
		// Adding interation handlers
		$('#displayWaypoints').button({ disabled : true });


		//TODO: Read waypoints (OBJ)-> compare to database -> Display data from database
		$('#fileDialog').change(function(evt) {
			// console.log($(this).val());
			gjPath = $(this).val();
			var fs = require('fs');
			var data = fs.readFileSync(gjPath, "utf8");


		
			var rawArray = data.split("\n");
			


			for (var i = 0; i < rawArray.length; i++) 
			{
				var temp = rawArray[i].split(", ")
				window.routeArray[i] = new Array(2)		
				window.routeArray[i][0] = parseFloat(temp[0]);
				window.routeArray[i][1]	= parseFloat(temp[1]);
			};
	    	$('#displayWaypoints').button("enable");
	    });


	    $('#displayWaypoints').click(function()
	    {
	    	
			var poly = L.polyline(window.routeArray,{
			color: 'blue',
			weight: 3,
			opacity: 1,
			smoothFactor: 1
			});

			// var map = L.map('map');
			poly.addTo(routeLayer).bindPopup("Path 1");
			map.fitBounds(poly);


			// window.counter = 1;
			// var newCheckBox = document.createElement('input');
			// newCheckBox.type = 'checkbox';
			// newCheckBox.id = 'route'+(window.counter++);
			// newCheckBox.checked = true;
			// newCheckBox.name = newCheckBox.id;
			// newCheckBox.setAttribute('class','name_class');




			// var text = document.createTextNode("text 1");

			// var parent = document.getElementById(name_class);
			// parent.appendChild(newCheckBox);
			// parent.appendChild(text);
			// parent.appendChild(document.createElement("br"))

			$('#displayWaypoints').button("disable");
			$('#clearWaypoints').button("enable");
		});



	    $('#clearWaypoints').button({disabled: true});

		$('#clearWaypoints').click(function(){
			window.routeLayer.clearLayers();
			$('#clearWaypoints').button("disable");
		});

		// function addCheckboxes(name_class){
		// 	window.counter = 1;
		// 	var newCheckBox = document.createElement('input');
		// 	newCheckBox.type = 'checkbox';
		// 	newCheckBox.id = 'route'+(window.counter++);
		// 	newCheckBox.checked = true;
		// 	newCheckBox.name = newCheckBox.id;
		// 	newCheckBox.setAttribute('class','name_class');


		// 	var text = document.createTextNode("text 1");

		// 	var parent = document.getElementById(name_class);
		// 	parent.appendChild(newCheckBox);
		// 	parent.appendChild(text);
		// 	parent.appendChild(document.createElement("br"))
		// 	};

		// $('#green-all').click(function(){
		// 	 $('.abc').attr('checked', false);	
		// });


	};
	</script>
</head>
	
<body style="margin:0px; padding:5px;">
	<div  style="float: left; width: 25%;" id="left">
		<button id="add" class="button" style="float: left">Add Waypoint</button>
		<div 
		style=
			"padding: 10%; 
			width: 200px; 
			height: 30%;
			font-family: Courier New;
			overflow: auto;
			border-radius: 25px;
    		border: 2px solid #8AC007;
    		padding: 20px;
    		width: 200px;
    		height: 150px;
    		float: left"
    	>
    	 		<button id="green-all" class="button">
    			all
    			</button>
    
    	<form id="green">
    	</form>
		</div>
	</div>
	<div style="width: 75%; float: right" id="right">
		<div style="height: 90%; width: 100%; float: right" id="map">
		</div>
			<div style="padding-left:10px; float: bottom; margin-top: 10px">
				<input id="fileDialog" type="file" accept=".txt" style="margin-top: 30px"/>
				<button id="clearWaypoints" class="button" style="float:right; margin-left:10px; margin-right:20px; margin-top: 20px">Clear</button>
				<button id="displayWaypoints" class="button" style="float:right; margin-top: 20px">Display</button>
			</div>
	</div>
</body>
</html>